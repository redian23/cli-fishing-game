#!/bin/bash

#TODO
# раскрасить ехо
# картинки рыб
# 
# 
#

#SPREY'S

WAITING_ANIMATION_POSITION1_1="\n
_________________________\n
|\t\t\t			        |\n 
|\t\t\t			        |\n
|\t\t  \  \t		    |\n
|\t\t  o  \t 		    |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|_______________________|\n 
"
WAITING_ANIMATION_POSITION1_2="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t  |  \t            |\n
|\t\t  o  \t            |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

WAITING_ANIMATION_POSITION1_3="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t  /  \t            |\n
|\t\t  o  \t            |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION1_1="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t  (o)  \t          |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION1_2="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t( o ) \t           |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION1_3="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t (   o   )\t       |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

##/-----------------------------------/

WAITING_ANIMATION_POSITION2_1="\n
_________________________\n
|\t\t\t			        |\n 
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t  \  \t\t		    |\n
|\t  o  \t\t 		    |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|_______________________|\n 
"
WAITING_ANIMATION_POSITION2_2="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t  |  \t\t            |\n
|\t  o  \t\t            |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

WAITING_ANIMATION_POSITION2_3="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t  /  \t\t            |\n
|\t  o  \t\t            |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION2_1="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t  (o)  \t\t          |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION2_2="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t( o ) \t\t           |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION2_3="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t (   o   )\t\t       |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

##/-----------------------------------/

WAITING_ANIMATION_POSITION3_1="\n
_________________________\n
|\t\t\t			        |\n 
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t    \  \t		    |\n
|\t\t    o  \t		    |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|\t\t\t			        |\n
|_______________________|\n 
"
WAITING_ANIMATION_POSITION3_2="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t    |  \t          |\n
|\t\t    o  \t          |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

WAITING_ANIMATION_POSITION3_3="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t    /  \t          |\n 
|\t\t    o  \t          |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION3_1="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t    (o)   \t       |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION3_2="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t   ( o )   \t      |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

BITE_ANIMATION_POSITION3_3="\n
_________________________\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t   (   o   ) \t    |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|\t\t\t                 |\n
|_______________________|\n
"

#Welcome
clear
echo -e "\e[32mWelcome!\e[0m" 
echo "You are start to play in Console Fishing"
echo "This is simlpe bash script, but to have so mach fun."
echo -e "\e[33mCreate by Redian23\e[0m"
echo -e "\e[31mVersion 0.3.5 beta\e[0m"
sleep 5s

# Global initialize borders
FLOOR=10
RANGE=100

#initialize variebles
CATCH=0
ENV=0
FISH_WEIGHT=0

#Select fish-rog
FISH_FOG_MAX_WEIGHT=0
money=300

select_fish_rog(){
stty echo

clear
echo -e "You are have a $money$"
echo "
List fish-ros:
1. Price - 100$; Max Weith - 5kg; 
2. Price - 250$; Max Weith - 10kg; 
3. Price - 450$; Max Weith - 20kg; 

Selecte Fish-rog:"

fishrogs=("Fish-rog 1" "Fish-rog 2" "Fish-rog 3" "Quit")
select opt in "${fishrogs[@]}"
do
    case $opt in
        "Fish-rog 1")
            if [ "$money" -lt "100" ];then
                echo "You don't have a money. Sorry :("
                sleep 5s
                exit 0
            fi
            ((money-=100))       
            FISH_FOG_MAX_WEIGHT=5000
            echo "You are select Fish-rog 1; -100$"
            sleep 1s
            break
            ;;
        "Fish-rog 2")
            if [ "$money" -lt "250" ];then
                echo "You don't have a money. Sorry :("
                sleep 5s
                exit 0
            fi
            ((money-=250)) 
            FISH_FOG_MAX_WEIGHT=10000
            echo "You are select Fish-rog 2; -250$"
            sleep 1s
            break
            ;;
        "Fish-rog 3")
            if [ "$money" -lt "450" ];then
                echo "You don't have a money. Sorry :("
                sleep 5s
                exit 0
            fi
            ((money-=450)) 
            FISH_FOG_MAX_WEIGHT=20000
            echo "You are select Fish-rog 3; -450$"
            sleep 1s
            break
            ;;
        "Quit")
            exit 0
            ;;
        *)  
            echo "invalid option $REPLY"
            ;;
    esac
done
game
}

#START GAME 

select_position(){

# Select one of many position of bobber

clear
echo "Please enter position your bobber:"
positions=("Small lake" "River" "Ocean" "Quit")
select opt in "${positions[@]}"
do
    case $opt in
        "Small lake")
            RANGE=7500

            WAITING_ANIMATION_1=$WAITING_ANIMATION_POSITION1_1
            WAITING_ANIMATION_2=$WAITING_ANIMATION_POSITION1_2
            WAITING_ANIMATION_3=$WAITING_ANIMATION_POSITION1_3
            BITE_ANIMATION_1=$BITE_ANIMATION_POSITION1_1
            BITE_ANIMATION_2=$BITE_ANIMATION_POSITION1_2
            BITE_ANIMATION_3=$BITE_ANIMATION_POSITION1_3
            
            echo "you chose position 1"
            sleep 0.5s
            break
            ;;
        "River")
            RANGE=12000

            WAITING_ANIMATION_1=$WAITING_ANIMATION_POSITION2_1
            WAITING_ANIMATION_2=$WAITING_ANIMATION_POSITION2_2
            WAITING_ANIMATION_3=$WAITING_ANIMATION_POSITION2_3
            BITE_ANIMATION_1=$BITE_ANIMATION_POSITION2_1
            BITE_ANIMATION_2=$BITE_ANIMATION_POSITION2_2
            BITE_ANIMATION_3=$BITE_ANIMATION_POSITION2_3
            
            echo "you chose position 2"
            sleep 0.5s
            break
            ;;
        "Ocean")
            RANGE=40000

            WAITING_ANIMATION_1=$WAITING_ANIMATION_POSITION3_1
            WAITING_ANIMATION_2=$WAITING_ANIMATION_POSITION3_2
            WAITING_ANIMATION_3=$WAITING_ANIMATION_POSITION3_3
            BITE_ANIMATION_1=$BITE_ANIMATION_POSITION3_1
            BITE_ANIMATION_2=$BITE_ANIMATION_POSITION3_2
            BITE_ANIMATION_3=$BITE_ANIMATION_POSITION3_3

            echo "you chose position 3"
            sleep 0.5s
            break
            ;;
        "Quit")
            exit 0
            ;;
        *)  
            echo "invalid option $REPLY"
            ;;
    esac
done
}

casting(){
    clear
    echo "There is a cast ~"
    sleep 0.5s
    clear
    echo "There is a cast ~~"
    sleep 0.5s
    clear
    echo "There is a cast ~~~"
    sleep 0.5s  
    clear
    echo "There is a cast ~~~~o"
    sleep 0.5s
    clear
    echo "There is a cast ~~~~(o)"
    sleep 0.5s  
}

# START Animation 

gen_env(){
    ENV=$RANDOM
    let "ENV %= $RANGE" 
}

gen_catch(){
    CATCH=$RANDOM
    let "CATCH %= $RANGE"  
}

text_catcha(){
    clear
    echo "CCCCAAAATTCCHAAAAA!!!!!!"
    sleep 1s
}

waiting(){
gen_env
#     while :
#     do
        clear
        gen_catch
        if [ $CATCH == $ENV ]; then 
            text_catcha
            break;
        else
            #echo $CATCH!=$ENV #DEBUG TAKT INFO
            echo -e  $WAITING_ANIMATION_1
            sleep 0.75s
        fi

        clear
        gen_catch
        if [ $CATCH == $ENV ]; then 
            text_catcha
            break;
        else
            #echo $CATCH!=$ENV #DEBUG TAKT INFO
            echo -e $WAITING_ANIMATION_2
            sleep 0.75s
        fi

        clear
        gen_catch
        if [ $CATCH == $ENV ]; then 
            text_catcha
            break;
        else
            #echo $CATCH!=$ENV #DEBUG TAKT INFO
            echo -e $WAITING_ANIMATION_3
            sleep 0.75s
        fi

        clear
        gen_catch
        if [ $CATCH == $ENV ]; then 
            text_catcha
            break;
        else
            #echo $CATCH!=$ENV #DEBUG TAKT INFO
            echo -e $WAITING_ANIMATION_2
            sleep 0.75s
        fi
#     done
}

# Animation PocKlewKI BLEAT

BITE_ANIMATION(){
    clear
        echo -e $BITE_ANIMATION_1   
    sleep 1s
    clear
        echo -e $BITE_ANIMATION_2  
    sleep 1s
    clear
        echo -e $BITE_ANIMATION_3  
    sleep 1s
    clear   
        echo -e $BITE_ANIMATION_2
    sleep 1s
}

press_F(){
    echo -ne "\rTo catch fish press 'F' ."
    sleep 0.2s
    echo -ne "\rTo catch fish press 'F' .."
    sleep 0.2s
    echo -ne "\rTo catch fish press 'F' ..."
    sleep 0.2s
    echo -ne "\rTo catch fish press 'F' ...."
    echo ""
    sleep 0.2s
}

skip_bite(){
    clear
    echo "You are skiped bite (X_X)"
    sleep 5s
}

fish-rog_broken(){
    stty -echo
    echo ""
    echo "Your fish-rod is broken (T_T)"
    sleep 5s

    select_fish_rog
    sleep 3s
}

got_off(){ 
    clear
    echo "Got off fish :("
    echo "Let's try again!"
    echo "Good Luck in next time!"
    sleep 5s
}

caught(){
FISH_WEIGHT=$RANDOM
let "FISH_WEIGHT %= $RANGE"

    if [ "$FISH_WEIGHT" -ge "$FISH_FOG_MAX_WEIGHT" ];then
        fish-rog_broken
        sleep 5s
    else    
        clear
        echo "We are caught! :)"
        echo -e $(shuf -n1 -e "\e[31mCarpe\e[0m" "\e[32mRuff\e[0m" "\e[33mRoach\e[0m" "\e[34mPike\e[0m")
        echo "WEIGHT: $FISH_WEIGHT g."
        sleep 5s
    fi
}

get_coin(){
    coin=$(($FISH_WEIGHT/100))
    ((money+=$coin))
    echo "Fish saled! You a get $coin$"
    sleep 1s 
}

fish_sale(){
stty echo
    echo 'Sale fish or release fish"'
    
    select opt in sale release ; 
    do
        case $opt in
        "sale")
            get_coin
            break
            ;;
        "release")
            echo "Let to water..."
            speep 3s
            break
            ;;
        *) 
            echo invalid option 
            ;;
        esac
    done
}

result(){
    if (( RANDOM % 2 )); 
        then 
            got_off;
        else 
            caught
            fish_sale; 
    fi
}

bite(){
stty -echo
PROGRESS=0
bar=''

BITE_ANIMATION        
press_F

while true;
do
stty -echo
read -rs -N 1 -t 1 input

    if [ "$input" = "f" ] || [ "$input" = "а" ]; then     # Russian "a" on key button F 
        ((PROGRESS+=1))
        sleep 0.05
        bar="${bar} "
        
        echo -ne "\r"
        echo -ne "\e[46m$bar\e[0m"
        echo -n "${PROGRESS}%"
    else
        ((PROGRESS-=1))
        sleep 0.05
        bar="${bar} "
        
        echo -ne "\r"
        echo -ne "\e[41m$bar\e[0m"
        echo -n "${PROGRESS}%"
    fi

    if [ $PROGRESS = 100 ];then
        echo ""
        echo "What i'd catch ???"
        sleep 3s
        result
        break;
    fi
    
    if [ $PROGRESS = -10 ];then
        skip_bite
        break;
    fi
done
}

#Notification Restart or Exit 
quit(){
stty echo

clear
echo "You have a $money$
"
echo 'Please select "Restart" or "Switch Fish-rog" or "Exit"'
select opt in restart switch quit ; 
do
     case $opt in
       "restart")
            echo "you chose restart" 
            sleep 1s
            game
            ;;
        "switch")
            echo "you chose switch fish-rog"
            sleep 1s 
            select_fish_rog
            ;;
        "quit")
            clear
            echo "Exit..."
            exit 0 
            ;;
        *) echo invalid option ;;
    esac
done
sleep 5s
}

game(){
    select_position
    casting
    waiting
    bite
    quit
}

select_fish_rog
game 
